# RoboHouse CRM System 1.0.1

### Общая информация
**Краткое описание:** Система, разрабатываемая в рамках курса "Современных Технологий Программирования". Проект разрабатывается как комплексная CRM-система для компании RoboHouse (https://robo.house), предоставляющей курсы робототехники и программирования.
Предназначение системы - структурирование курсов и их типов; описаний и партнеров; стоимостей и учеников, посещающих занятия.

Предполагается наличие трех основных типов пользователей:
- *Пользователь*. Имеет возможность получить сводку занятий, уведомление в мессенджер о занятии, доступ к простой панели для оплаты занятий и просмотра расписание, а также детализированных данных.
- *Менеджер*. Управляет доступными занятиями; утверждает оплаты пользователей, обновляет информацию о тренерах, занимающихся и локациях.
- *Администратор*. Имеет наибольший спектр прав. Отправляет обновления в новости. Управляет пользователями и модераторами. Утверждает изменения, вносимые модераторами.

**Старт разработки:** 7 сентября 2019 года.

**Используемые технологии:**
*Front-End*: React, SCSS, Bulma
*Back-End*: Node, Express, Axios, Cheerio
*Database*: PostgreSQL (under pgAdmin4)
*Deployment:* Heroku, local FTP (by MiroHost)
*Linter*: ESLint

### Структура репозитория:
*Master* содержит ведомую ветку проекта, в которую регулярно вносятся изменения и обновления. Ветка не стабильная, постоянно ломается.
*R&D* содержит документы проектирования архитектуры приложения, базы данных, базовые UML-диаграммы.
*Devel*-ветка хранит дампы последних стабильных версий проекта. С нее можно брать клон и мучить. А лучше не мучить.

### Журнал изменений:

###### 19 октября 2019
Написана логика простых Service-Providers, дающих возможность децентрализовать работу приложения и структурировать выполняемые задачи.
Таким образом, два сервиса, выполняют следующие задачи:
**Первый**
*/search/"search by name"* - предназначен для всех типов пользователей, и позволяет выполнять поиск групп по базе данных по названию группы.
*app.get('/search/:query', db.getFilteredClasses);* - формат вызова сервисного запроса.

**Второй**
*app.get('/details/:id', db.getDetailsById);* - выдает информацию о группе и описание по идентификатору группы. Предназначено для менеджеров, выполняющих обзвон клиентов и предлагающим им услуги.
*app.get('/price-list', db.getPriceList);* - выдает общий список стоимостей на услуги.

Данные на промежуточном этапе записываются на отдельно выделенный FTP, по линкам:
http://rhcrm.z-digital.net/first-data.html/
http://rhcrm.z-digital.net/second-data.html/

Запись на FTP в формате html-страниц была выполнена для наглядности, а также с целью перенести впоследствии текущий функционал на полностью функциональный фронтенд.

Также, была разработана простая CLI, позволяющая определить тип сервиса, который используется, внести ссылки для взаимодействия, и типы отображения данных. На данный момент, реализованы следующие типы:
*Bunch* - отображает весь набор данных о всех группах.
*Prices* - отображает группы и их стоимости.
*Descriptions* - отображает группы по запросу и их описания.

Все эти данные берутся из сервисов. Сервисы, в свою очередь, функицонируют на внешнем клиенте, по запросам извне.

![](https://ibb.co/rmg69Zr)
*Пример взаимодействия с CLI*

###### 13 октября 2019
В архитектуру приложения были добавлены базовые паттерны проектирования, дабы структурировать разработку.

Для подключения к базе данных, написан паттерн **Singleton**, который инициализирует объект подключения с креддлами единожды, не позволяя вызовам к БД перекрыться. Объект инициализации создается в файле *dataSelectedAdapter*. В нем же инициализируются креддлы, *в перспективе они будут вынесены на удаленный сервис для безопасности*.

Для формирование банча данных, отправляемых в базу данных посредством Post/Put запроса, разработан класс dataClassBuilder. В конструкторе он принимает необходимый пакет данных, итоговый объект, сформированный из которых, по итогу, отправляется в dataClass на обработку.

Описанные выше паттерны позвляют выделить **Persistense-слой** абстракции.

Для упрощения именований, неявно внедрен паттерн **Facаde**, выполняющий функцию сокрытия общих путей к функциям, и позвляющий делать запрос относительно одного объекта. Пример - вызываемые функции в index.js относительно эндпоинтов. Как видим, все вызовы производятся относительно объекта db, но, по факту, объект сокрывает в себе более комплексную цепочку вызовов.

Базовая бизнес-логика реализована паттерном **Specification** (Specification.js). Базовые функции реализовывают булевую логику. На основе этих функций, разработан пакет функций:
**classNameIs** - проверяет соответствие именования группы
**priceIsLowerThan** - проверяет соответствие стоимости верхней границе
**groupIsBiggerThan** - проверяет соответствие кол-ва учеников в группе нижней границе
Эти функции далее в перспективе будут использоваться в запросах.

Ниже представлены скриншоты результатов работы с запросами по эндпоинтам, и базовая демонстрация CRUD.

![](https://ibb.co/BBY94z1)
![](https://ibb.co/S5dbm6j)
![](https://ibb.co/G2zJ1p9)
![](https://ibb.co/xCfWpp3)
![](https://ibb.co/1G0F1yn)

###### 11 октября 2019
Написали базовую версию сервера с ключевыми эндпоинтами. Реализовали набор эндпоинтов, по которым можно получить базовый CRUD-функционал.
**Список эндпоинтов:**
GET-пакет:
*/classes* - выдает все доступные занятия из базы данных.
*/classes/:id* - выдает занятие по его идентификатору (Primary Key в базе данных)
*/classes/:class_name/:st_amount/:pr* - выдает занятие по опциональному фильтру - цене, названию, или количеству студентов.

POST-пакет:
*/classes* - позволяет создать новую группу в базе со всеми прилегающими данными.

PUT-пакет:
*/classes/:id* - позволяет обновить данные о группе по идентфикатору.

DELETE-пакет:
*/classes/:id* - удаляет группу по ее идентификатору.

Сама база разворачивается на локальном хосте из бекапа.
Сервер разворачивается с помощью Express, по адресу localhost:3000.

###### 1 октября 2019
Спроектирована тестовая версия базы данных. Получено разрешение на использование данных от представителей компании B-Sharks (собственники RoboHouse). Дамп базы данных залит в master-ветку.

###### 22 сентября 2019
Подгтовлено проектирование базы данных в формате мок-апа. Описана базовая логика работы общих компонент. Все детали сохранены в ветке R&D.

###### 16 сентября 2019
Написан Research&Development документ, описывающий рекомендации к разработке проекта и базовой архитектуре. Также документ описывает базовый анализ рынка, сводку деталей относительно ASO/GPO процессов, рекомендации к UI/UX дизайну и проектированию.
